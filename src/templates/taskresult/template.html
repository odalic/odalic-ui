<!-- Main Content -->
<!-- TODO: Styly treba premiestnit do css/less. Pouzi helpers.less pre "miscellaneous" styly. -->
<style>
    .selectBoxIcon {
        width: 15px;
        height: 15px;
        /*float: right;*/
    }

    .markedColumn {
        background-color: WhiteSmoke;
    }
    /*TODO mozna jiny typ oznaceni*/
    .markedCell {
        outline: 1px solid black !important;
    }


    .boldPrimaryKB {
        font-weight: bold;
    }

    .evenRow {
        background-color: WhiteSmoke;
    }

    .headerRow {
        background-color: Gainsboro;
    }

    /* Graphical separation of buttons */
    /* TODO: Generalize and put to *.LESS */
    .odalic-hr-separator {
        width: 100%;
        border-bottom: 1px solid lightgrey;
        margin-top: 5px;
        margin-bottom: 5px;
        text-align: center;
    }

    .odalic-hr-pushtop {
        margin-top: 75px;
    }

    .odalic-hr-pushbtm {
        margin-bottom: 15px;
    }

    /* lod iframe */
    iframe {
        position: fixed;
        top: 0px;
        right: 0px;
        width: 100%;
        height: 100%;
        z-index: 2000;
        background-color: #FFF;
    }
</style>

<style>
    /* Modal Content/Box */
    .modal-content {
        margin: 0% auto; /* 15% from the top and centered */
        padding: 20px;
    }
</style>


<main-cnt>
    <!-- NavBar -->
    <navbar selected="-1" lmenu="default-lm.json" rmenu="default-rm.json"></navbar>

    <div class="container-fluid">

        <!-- VIEW -->
        <div ng-switch="state" ng-init="state = 0">

            <!-- VIEW: Sets subject column  -->
            <div ng-switch-when="0">
                <h2>Choosing of a subject column</h2>

                <!-- Input file table -->
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <td ng-repeat="cell in inputFile.columns"
                                    ng-class="($index == subjectColumn) ? 'markedColumn' :''"
                                    ng-click="selectSubjectColumn($index)">
                                    {{ cell }}
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="row in inputFile.rows">
                                <td ng-repeat="cell in row" ng-class="($index == subjectColumn) ? 'markedColumn' : ''"
                                    ng-click="selectSubjectColumn($index)">
                                    {{ cell }}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VIEW: Sets classifications and disambiguations -->
            <div ng-switch-when="1">
                <h2>Choosing of classifications and disambiguations</h2>
                <!-- Input file table -->
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr ng-class="'headerRow'">
                                <td ng-repeat="cell in inputFile.columns"
                                    ng-class="(-1 == selectedPosition.row) && ($index == selectedPosition.column) ? 'markedCell' : ''"
                                    ng-click="selectPosition($index, -1)"
                                    data-toggle="modal" data-target="#myModal">
                                    <!-- origin header from the input table -->
                                    <div>
                                        {{ cell }}
                                    </div>
                                    <!-- primary knowledge base classifications-->
                                    <div ng-class="'boldPrimaryKB'" ng-style="backgroundColor(primaryKB)" ng-repeat="class in currentItems[-1][$index][primaryKB]">
                                        {{x+ class.label  + ' ' + '(' + class.resource + ')' }}

                                    </div>

                                    <!-- other knowledge base classifications-->
                                    <div ng-repeat="(KB,data) in currentItems[-1][$index]">
                                        <div ng-if="KB != primaryKB">
                                            <div ng-style="backgroundColor(KB)" ng-repeat="class in data">
                                                {{ class.label  + ' ' + '(' + class.resource + ')'  }}
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-class-even="'evenRow'" ng-repeat="row in inputFile.rows">
                                <td ng-repeat="cell in row"
                                    ng-class="($parent.$index == selectedPosition.row) && ($index == selectedPosition.column) ? 'markedCell' : ''"
                                    ng-click="selectPosition($index, $parent.$index)"
                                    data-toggle="modal" data-target="#myModal">
                                    <!-- origin cell value from the input table -->
                                    <div>
                                        {{ cell }}
                                    </div>
                                    <!-- primary knowledge base disambiguation -->
                                    <div ng-class="'boldPrimaryKB'" ng-style="backgroundColor(primaryKB)" ng-repeat="disam in currentItems[$parent.$index][$index][primaryKB]">
                                        {{ disam.label  + ' ' + '(' + disam.resource + ')' }}
                                    </div>
                                    <!-- other knowledge base disambiguation  -->
                                    <div ng-repeat="(KB,data) in currentItems[$parent.$index][$index]">
                                        <div ng-if="KB != primaryKB">
                                            <div ng-style="backgroundColor(KB)" ng-repeat="disam in data">
                                                {{ disam.label  + ' ' + '(' + disam.resource + ')' }}}
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!--<iframe src="LodLive/app_en.html?http://dbpedia.org/resource/Steven_Erikson" id="iframe"></iframe>-->
                <!--<button class="btn btn-lg" ng-click=pokus()>
                    Start from the beginning
                </button>
                <div><dfeedback :{{bla}}</div>-->
                <!--{{primaryKB}}

                {{chosenKBs}}
                <div>feedback :{{feedback}}</div>
                <div>bla :{{currentItems}}</div>
                <div>ignoredColumn :{{ignoredColumn}}</div>
                <div>noDisambiguationColumn :{{noDisambiguationColumn}}</div>
                <div>noDisambiguationCell :{{noDisambiguationCell}}</div>-->
                <!-- Modal window for classification/disambiguation selection -->
                <!--
                   TODO: odselcteni crtl - click -> dotykove pristroje vi buh
                   TODO: init selection : currentItems[selectedPosition.row+selectedPosition.column] == [www.dbpedia, www.dbpedia]
                   TODO: stylovanie
                -->






                <div id="myModal" class="modal" role="dialog">
                    <div class="modal-dialog lg">
                        <div class="modal-content">

                            <!-- Column classification -->
                            <div ng-if="(selectedPosition.row == -1)">

                                <div class="modal-head">
                                    <h2>Column classification</h2>
                                </div>

                                <!--<ui-select-choices repeat="person in ctrl.people | propsFilter: {name: $select.search, age: $select.search}">
                                    <div ng-bind-html="person.name | highlight: $select.search"></div>-->


                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <div class="form-group">
                                            <h3 ng-class="'boldPrimaryKB'">{{primaryKB + " (Primary KB)" }}</h3>
                                            <!-- Selection of a candidate(s) for the current knowledge base -->
                                            <!-- in progress -->


                                            <ui-select ng-model="currentItems[selectedPosition.row][selectedPosition.column][primaryKB]" multiple theme="bootstrap" search-enabled="true" width="100">
                                                <ui-select-match placeholder="Pick one...">
                                                    <img ng-click="createIframe($item.entity,primaryKB,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                    &nbsp
                                                    {{$item.entity.label}}<br>  ({{$item.entity.resource}})
                                                </ui-select-match>
                                                <ui-select-choices repeat="opt.entity as opt in result.headerAnnotations[selectedPosition.column].candidates[primaryKB]  | propsFilter : {'entity.resource': $select.search, 'entity.label': $select.search}">
                                                    <img ng-click="createIframe(opt.entity,primaryKB,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                    &nbsp
                                                    <span title={{opt.entity.resource}} ng-bind-html="opt.entity.label| highlight: $select.search"></span>
                                                    <div title={{opt.entity.resource}} ng-bind-html="' ('+opt.entity.resource + ')'| highlight: $select.search"></div>
                                                </ui-select-choices>
                                            </ui-select>


                                        </div>

                                        <!-- Separate div for each knowledge base -->
                                        <div ng-repeat="(knowledgeBase, candidates) in result.headerAnnotations[selectedPosition.column].candidates">
                                            <div ng-if="knowledgeBase != primaryKB">
                                                <div class="form-group">
                                                    <h3>{{ knowledgeBase }}</h3>
                                                    <ui-select ng-model="currentItems[selectedPosition.row][selectedPosition.column][knowledgeBase]" multiple theme="bootstrap" search-enabled="true" width="100">
                                                        <ui-select-match placeholder="Pick one...">
                                                            <img ng-click="createIframe($item.entity,knowledgeBase,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                            &nbsp
                                                            {{$item.entity.label}}<br>  ({{$item.entity.resource}})
                                                        </ui-select-match>
                                                        <ui-select-choices repeat="opt.entity as opt in result.headerAnnotations[selectedPosition.column].candidates[knowledgeBase]  | propsFilter : {'entity.resource': $select.search, 'entity.label': $select.search}">
                                                            <img ng-click="createIframe(opt.entity,knowledgeBase,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                            &nbsp
                                                            <span title={{opt.entity.resource}} ng-bind-html="opt.entity.label| highlight: $select.search"></span>
                                                            <div title={{opt.entity.resource}} ng-bind-html="' ('+opt.entity.resource + ')'| highlight: $select.search"></div>
                                                        </ui-select-choices>
                                                    </ui-select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- user can write own classification -->
                                        <div class="form-group">
                                            <label class="control-label"> Own classification:</label>
                                            <input type="text" class="form-control" ng-model="currentItems[selectedPosition.row][selectedPosition.column].other[0].resource" ng-disabled="true">
                                        </div>
                                        <!-- algorithm ignore chosen column -->
                                        <div class="checkbox">
                                            <label><input type="checkbox" ng-model="ignoredColumn[selectedPosition.column]" ng-disabled="true"> Ignore Column</label>
                                        </div>

                                        <div class="checkbox">
                                            <label><input type="checkbox" ng-model="noDisambiguationColumn[selectedPosition.column]" ng-disabled="true"> Skip disambiguation in all cell of this collumn </label>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- Cell disambiguation -->
                            <div ng-if="(selectedPosition.row != -1)">
                                <div class="modal-head">
                                    <h2>Cell disambiguation</h2>
                                </div>

                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <div class="form-group">
                                            <!-- Separate div for each knowledge base -->
                                            <h3 ng-class="'boldPrimaryKB'">{{ primaryKB + " (Primary KB)"}}</h3>
                                            <!-- Selection of a candidate(s) for the current knowledge base -->
                                            <ui-select ng-model="currentItems[selectedPosition.row][selectedPosition.column][primaryKB]" multiple limit="1" theme="bootstrap" search-enabled="true" on-select="onSelectCallback($item.entity, primaryKB)">
                                                <ui-select-match placeholder="Pick one...">
                                                    <img ng-click="createIframe($item.entity,primaryKB,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                    &nbsp
                                                    {{$item.entity.label}} <br> ({{$item.entity.resource}})
                                                </ui-select-match>
                                                <ui-select-choices repeat="opt.entity as opt in result.cellAnnotations[selectedPosition.row][selectedPosition.column].candidates[primaryKB]  | propsFilter : {'entity.resource': $select.search, 'entity.label': $select.search}" onselect="$item">
                                                    <img ng-click="createIframe(opt.entity,primaryKB,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                    &nbsp
                                                    <span title={{opt.entity.resource}} ng-bind-html="opt.entity.label| highlight: $select.search"></span>
                                                    <div title={{opt.entity.resource}} ng-bind-html="' ('+opt.entity.resource + ')'| highlight: $select.search"></div>
                                                </ui-select-choices>
                                            </ui-select>

                                            <!-- Separate div for each knowledge base -->
                                            <div ng-repeat="(knowledgeBase, candidates) in result.cellAnnotations[selectedPosition.row][selectedPosition.column].candidates">

                                                <div ng-if="knowledgeBase != primaryKB">
                                                    <div class="form-group">
                                                        <h3>{{ knowledgeBase }}</h3>
                                                        <!-- Selection of a candidate(s) for the current knowledge base -->
                                                        <ui-select ng-model="currentItems[selectedPosition.row][selectedPosition.column][knowledgeBase]" multiple limit="1" theme="bootstrap" search-enabled="true" on-select="onSelectCallback($item.entity, knowledgeBase)">
                                                            <ui-select-match placeholder="Pick one...">
                                                                <img ng-click="createIframe($item.entity,knowledgeBase,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                                &nbsp
                                                                {{$item.entity.label}} <br> ({{$item.entity.resource}})
                                                            </ui-select-match>
                                                            <ui-select-choices repeat="opt.entity as opt in result.cellAnnotations[selectedPosition.row][selectedPosition.column].candidates[knowledgeBase]  | propsFilter : {'entity.resource': $select.search, 'entity.label': $select.search}">
                                                                <img ng-click="createIframe(opt,knowledgeBase,$event)" title="lodlive browser" ng-src="{{lodLiveBrowserIcon}}" ng-class="'selectBoxIcon'" />
                                                                &nbsp
                                                                &nbsp
                                                                <span title={{opt.entity.resource}} ng-bind-html="opt.entity.label| highlight: $select.search"></span>
                                                                <div title={{opt.entity.resource}} ng-bind-html="' ('+opt.entity.resource + ')'| highlight: $select.search"></div>
                                                            </ui-select-choices>
                                                        </ui-select>

                                                    </div>
                                                </div>
                                            </div>

                                            <!-- user can write own classification -->
                                            <div class="form-group">
                                                <label class="control-label"> Own disambiguation:</label>

                                                <input class="form-control" type="text" ng-model="currentItems[selectedPosition.row][selectedPosition.column].other[0].resource" ng-disabled="true">


                                                <div class="checkbox">
                                                    <label><input type="checkbox" ng-model="noDisambiguationCell[selectedPosition.row][selectedPosition.column]" ng-disabled="true"> Skip disambiguation in the cell</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: Relations -->
            <div ng-switch-when="2">
                <h2>Choosing of predicates</h2>
                <!-- Modal -->
                <div id="modalPredicates" class="modal" role="dialog">
                    <div class="modal-dialog lg">
                        <div class="modal-content">
                            <!-- Headline -->
                            <div class="modal-head">
                                <h2>Predicates</h2>
                            </div>
                            <!-- Body -->
                            <div class="modal-body">
                                <div class="container-fluid">
                                    <div class="form-group">
                                        <!-- Separate div for each knowledge base -->
                                        <h3 ng-class="'boldPrimaryKB'">{{ primaryKB + " (Primary KB)"}}</h3>
                                        <!-- Selection of a candidate(s) for the current knowledge base -->
                                        <ui-select ng-model="currentRelations[selectedRelation.column1][selectedRelation.column2][primaryKB]" multiple limit="1" theme="bootstrap" search-enabled="true" on-select="onSelectRelation($item.entity, primaryKB)" ng-change="gvmodal.modalPredicatesChange()">
                                            <ui-select-match placeholder="Pick one...">
                                                {{$item.entity.resource}}
                                            </ui-select-match>
                                            <ui-select-choices repeat="opt.entity as opt in result.columnRelationAnnotations[selectedRelation.column1][selectedRelation.column2].candidates[primaryKB]  | propsFilter : {'entity.resource': $select.search}">
                                                <div title={{opt.entity.resource}} ng-bind-html="opt.entity.resource| highlight: $select.search"></div>
                                            </ui-select-choices>
                                        </ui-select>                    
                                    </div>
                                    <!-- Separate div for each knowledge base -->
                                    <div ng-repeat="(knowledgeBase, candidates) in result.columnRelationAnnotations[selectedRelation.column1][selectedRelation.column2].candidates">
                                        <div ng-if="knowledgeBase != primaryKB">
                                            <div class="form-group">
                                                <h3>{{ knowledgeBase }}</h3>
                                                <!-- Selection of a candidate(s) for the current knowledge base -->
                                                <ui-select ng-model="currentRelations[selectedRelation.column1][selectedRelation.column2][knowledgeBase]" multiple limit="1" theme="bootstrap" search-enabled="true" on-select="onSelectRelation($item.entity, knowledgeBase)" ng-change="gvmodal.modalPredicatesChange()">
                                                    <ui-select-match placeholder="Pick one...">
                                                        {{$item.entity.resource}}
                                                    </ui-select-match>
                                                    <ui-select-choices repeat="opt.entity as opt in result.columnRelationAnnotations[selectedRelation.column1][selectedRelation.column2].candidates[ knowledgeBase]  | propsFilter : {'entity.resource': $select.search}">
                                                        <div title={{opt.entity.resource}} ng-bind-html="opt.entity.resource| highlight: $select.search"></div>
                                                    </ui-select-choices>
                                                </ui-select> 
                                            </div>
                                        </div>
                                    </div>
                                    <!-- user can write own relation -->
                                    <div class="form-group">
                                        <label class="control-label">Own relation:</label>
                                        <input class="form-control" type="text" ng-change="gvmodal.modalPredicatesChange()" ng-model="currentRelations[selectedRelation.column1][selectedRelation.column2].other[0].resource">
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>

                <!-- Graph visualiser -->
                <graphvis scope="{{ gvscope }}"></graphvis>
            </div>

            <!-- VIEW: Default -->
            <div ng-switch-default>
                <!-- TODO: Nie je ten default zbytocny? Aj tak je v controlleri nastaveny defaultny stav ako "1" -->
                <h2>Choosing of relationships between columns</h2>
            </div>

        </div>

        <div class="form-group odalic-hr-pushbtm">
            <div class="col-md-3">
                <!--TODO spustit to znova-->
                <button class="btn btn-lg btn-block" ng-click="" disabled="true">
                    Start from the beginning
                </button>
            </div>
            <div class="col-md-2">
                <!--TODO prepsat na  Re-run the algorithm az se to bude umet na serveru-->
                <button class="btn btn-lg btn-block" ng-click="setFeedback()" disabled="true">
                    Send feedback
                </button>

            </div>
            <div class="col-md-2 col-md-offset-3">
                <button class="btn btn-lg btn-block" ng-click="state = state - 1" ng-disabled="state <= 0">
                    Previous step
                </button>
            </div>
            <div class="col-md-2">
                <button class="btn btn-lg btn-block" ng-click="state = state + 1" ng-disabled="state >= 2">
                    Next step
                </button>
            </div>
        </div>

        <!-- Export -->
        <div class="odalic-hr-pushtop">
            <div class="col-md-12">
                <div class="odalic-hr-separator">Export</div>
            </div>

            <div class="col-md-12">
                <button class="btn" ng-click="exporting.json()">JSON</button>
                <button class="btn" ng-click="exporting.csv()">CSV</button>
                <button class="btn" ng-click="exporting.rdf()">RDF</button>
            </div>

            <div class="col-md-12">
                <div class="odalic-hr-pushbtm"></div>
            </div>
        </div>

        <br><br>

        <!-- VIEW: Pagination -->
        <!--
        <div class="tex
            t-center">
            <div class="text-center">
                <ul class="pagination">
                    <li><a class="pointer" ng-click="setState(state - 1)">Previous</a></li>

                    <li ng-repeat="single_state in states track by $index" ng-class="$index == state ? 'active' : ''">
                        <a class="pointer" ng-click="setState($index)">
                            {{ $index }}
                        </a>
                    </li>
                    <li><a class="pointer" ng-click="setState(state + 1)">Next</a></li>
                </ul>
            </div>-->
    </div>
</main-cnt>

<!-- Footer -->
<footer></footer>